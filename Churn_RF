setwd("C:\\Users\\bishw\\Dropbox\\IVY DATA SCIENCE\\Industry Project\\Random Forest\\RF training")
data<-read.csv("CallData.csv", na.strings = "")
str(data)
sapply(data, function(x) sum(is.na(x)))
library(dplyr)
data<-data%>%select(M_RECORD_TYPE, M_RECORD_STATUS, M_RECORD_STATUS, CIRCLE, Customer.Class,
                    Service.Segment, Customer.Segment, CC_REASON
              , Source, ZONE, REGION, Retained...Not.Retained, Contacted...Not.Contacted)
#install.packages("stringr")
library(stringr)
colnames(data)<-str_replace_all(string = colnames(data), pattern = "[_]", replacement = "")
colnames(data)<-str_replace_all(string = colnames(data), pattern = "[.]", replacement = "")
colnames(data)
tail(data)
table(data$RetainedNotRetained)
data$RetainedNotRetained<-ifelse(test = data$RetainedNotRetained=="Retained",1,0)
library(ROSE)
data.up<-ovun.sample(formula = RetainedNotRetained ~ . , data = data, method = "over", N =13320, seed = 1)$data
table(data.up$RetainedNotRetained)
data.up$RetainedNotRetained<-as.factor(data.up$RetainedNotRetained)
library(caTools)
split<-sample.split(Y = data.up$RetainedNotRetained, SplitRatio = 0.75)
train<-subset(x = data.up, subset = split==T)
test<-subset(x = data.up, subset = split==F)
library(randomForest)
rf<-randomForest(RetainedNotRetained ~ . , data = train, ntree=300,
                 mtry=6, importance=T, proximity=T )
print(rf)
plot(rf)
p1<-predict(object = rf, newdata = test)
library(caret)
confusionMatrix(p1, test$RetainedNotRetained)
tune<-tuneRF(x = train[,-11], y = train[,11], ntreeTry = 300, stepFactor = 0.5, improve = 0.05 , trace = T, plot = T)
median(treesize(rf))
varImpPlot(x = rf, sort = T, n.var = 10)

